extends ../layout
block content
	style().
		html{
			background-color: #f2f2f2;
		}
	script(src="../../js/validators.js")
	script(src="../../js/parseTable.js")
	script(src="../../../js/parseTable.js")
	script(src="../../../js/validators.js")
	script(src="../../../jquery/dist/jquery.min.js")
	script(src="node_modules/jquery/dist/jquery.min.js")
	script(src="../../../sweet_alerts/dist/sweetalert.min.js")
	link( rel="stylesheet" type="text/css" href="../../../sweet_alerts/dist/sweetalert.css")
	script().
		function pedidoTerminado(no_folio){
			swal({   
			   title: "¿Confirmación de cambio del estado del pedido?",
			   text: "No se podra revertir este cambio.",   
			   type: "warning",   
			   showCancelButton: true,   
			   confirmButtonColor: "#DD6B55",   
			   confirmButtonText: "Si, estoy seguro.",   closeOnConfirm: false }, 
			   function(){   
				 
				   	$.ajax({
					   url: '/pedidos/pendientes/'+no_folio+'/?_method=put',
					   type: 'POST',
					   success: function(response) {
						    if (response) {
					        	window.location.href = response;
					        	redirectWindow.location;
					        }
					   }
					});
					swal("Pedido Terminado!", "El estado del pedido ahora esta en terminado", "success"); 
			   });
		}
		function buscarPedido(){
			var filtro_por = document.getElementById('filtro').value;
			var valor = document.getElementById('valor').value;
			if(valor.length == 0 || valor==null){
				swal({
					title: "Error",
					text: "Falta valor para el filtro.",
					type: "error",
					confirmButtonText: "Aceptar"
				});
			}else{
				document.getElementById('link').setAttribute('href','/pedidos/pendientes/'+valor+'/');
				
			}
		}
	div(class="container-fluid")
		div(class="row" style="background: #465669;")
			div(class="col-md-3 text-center" style="background: #4e6075;") 
				h2(style="color:white;") Versatil
			div(class="col-md-9 text-center") 
				h2(style="color:white;") Lista de pedidos pendientes
		div(class="container")
			div(class="row" style="margin-top:2em;")
				label(class="col-sm-2 text-right control-label") Filtrar por:
				div(class="col-sm-2 text-left" )
					select(name="filtro_por" class="form-control" id="filtro")
						option(value="pedido") Nº Pedido
						option(value="cliente") Nombre cliente
				div(class="col-sm-2")
					input(type="text" class="col-sm-2 form-control" id="valor" placeholder="Valor de busqueda")
				a(href="#" style="color:white;" class="btn btn-info fa fa-search" id="link" onclick="buscarPedido();")   Buscar
			div(class="row" style="margin-top:2em;")
					table(class="table table-striped")
						thead
							tr
								th(style="text-align:center;") Nº Pedido
								th(style="text-align:center;") Fecha
								th(style="text-align:center;") Nombre cliente
								th(style="text-align:center;") Telefono cliente
								th(style="text-align:center;") Correo cliente
								th(style="text-align:center;") Estado

						tbody
							each pedido in pedidos
								tr
									td(style="text-align:center;" contenteditable=false) #{pedido.no_folio}
									td(style="text-align:center;" contenteditable=false) #{pedido.fecha}
									td(style="text-align:center;" contenteditable=false) #{pedido.nombre}
									td(style="text-align:center;" contenteditable=false) #{pedido.telefono}
									td(style="text-align:center;" contenteditable=false) #{pedido.correo}
									td(style="text-align:center;" contenteditable=false)
										select(class="form-control" onchange="pedidoTerminado(#{pedido.no_folio});")
											// h1=pedido.estado_pedido
											- if(pedido.estado_pedido == "pendiente"){
												option(value="pendiente") Pendiente
												option(value="terminado") Terminado
											-}else if(pedido.estado_pedido == "terminado"){
												option() Terminado
											-}

											

			div(class="row")
				div(class="col-sm-12 text-right" style="margin-bottom:2em;")
					a(href="/redirect_user" style="color:white;" class="btn btn-success fa fa-chevron-circle-left")  Regresar

